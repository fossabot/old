<template>
    <div
      class='avatar' :class="{'avatar-active': activeSpeakerMap[user.userId] != null}"
      :style="{width: width +'px', height: height +'px',top: top +'px',left: left +'px'}"
    >
      <span class="emoji">
        <img v-if="raisedHandMap[user.userId] && !reactionMap[user.userId]" :src="require(`../assets/images/raisehand.png`)"  />
        <img v-if="reactionMap[user.userId] && reactionMap[user.userId].reaction" :src="require(`../assets/images/${reactionMap[user.userId].reaction}.png`)"  />
      </span>
      <div class="corner-name">
        <v-icon v-if="muted==true" icon="mdi-volume-mute" size="large" color="blue-darken-2"></v-icon>
        <span v-if="bVideoOn">{{user.displayName}}</span>
      </div>
      <span v-if="!bVideoOn" class="center-name">{{ user.displayName }}</span>
      <div class="user-menu">
         <v-menu>
            <template v-slot:activator="{ props }">
              <v-btn
                icon="mdi-dots-vertical"
                color="#474747"
                size="x-small"
                v-bind="props"
              ></v-btn>
            </template>
            <v-list>
              <v-list-item
                @click="unpinUser"
                :key="'unpin'"
                v-if="userPin && user.userId == userPin.userId"
              >
                <v-list-item-title>UnPin</v-list-item-title>
              </v-list-item>
              <v-list-item
                @click="pinUser"
                :key="'pin'"
                v-else>
                <v-list-item-title>Pin</v-list-item-title>
              </v-list-item>
              <v-list-item
                @click="muteUser"
                :key="'mute'"
                v-if="!muted && isHost && !isSefl">
                <v-list-item-title>Mute</v-list-item-title>
              </v-list-item>
              <v-list-item
                @click="askUserToUnmute"
                :key="'askunmute'"
                v-if="muted && isHost && !isSefl">
                <v-list-item-title>Ask user to unmute</v-list-item-title>
              </v-list-item>
            </v-list>
          </v-menu>
      </div>
    </div>
</template>

<script>
import ZoomController from '../ZoomController'
export default {
    props: [
        'reactions',
        'user',
        'isActive',
        'bVideoOn',
        'muted',
        'displayName',
        'width',
        'height',
        'top',
        'left'
    ],
    data(){
      return {
        emoji: null,
        items: [
        { title: 'Pin' },
        { title: 'Click Me' },
        { title: 'Click Me' },
        { title: 'Click Me 2' },
      ],
      }
    },
    computed:{
      raisedHandMap () {
        //this.updateMeetingViewPorts()
        return this.$store.state.cmdRaisedHandMap
      },
      reactionMap () {
        //this.updateMeetingViewPorts()
        return this.$store.state.cmdReactionMap
      },
      activeSpeakerMap(){
        return this.$store.state.activeSpeakerMap
      },
      userPin(){
        return this.$store.state.userPin
      },
      isHost(){
        return ZoomController.zoomClient.isHost()
      },
      isSefl(){
        return ZoomController.zoomClient.getCurrentUserInfo().userId == this.user.userId
      }
    },
    methods: {
      getEmoji(id){
        this.emoji = this.reactions.filter((i)=>i.senderId == id)[0]
        return this.emoji
      },
      pinUser(){
        console.log("PinUser", this.user)
        this.$store.commit('setUserPin', this.user)
      },
      unpinUser(){
        this.$store.commit('setUserPin', null)
      },
      askUserToUnmute(){
        ZoomController.zoomClient.getMediaStream().unmuteAudio(this.user.userId)
      },
      muteUser(){
        ZoomController.zoomClient.getMediaStream().muteAudio(this.user.userId)
      }
    },
}
</script>

<style lang="scss" scoped>
  .avatar {
    position: absolute;
    width: 100%;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    outline: 3px solid #474747;
    &.avatar-active {
      outline: 3px solid #00D885;
    }
    .corner-name {
      position: absolute;
      left: 0;
      bottom: 0;
      display: flex;
      padding: 3px 5px;
      align-items: center;
      max-width: 100%;
      height: 25px;
      font-size: 14px;
      color: #fff;
      background-color: rgba(0,0,0,0.6);
      .anticon-audio-muted{
        margin-right: 5px;
      }
    }
    .center-name {
      /* font-size: 38px;
      font-weight: 700; */
      color: #fff;
    }
    .emoji{
      position: absolute;
      top: 10px;
      left: 10px;
      img{
        width: 30px;
        height: 30px;
      }
    }
    .user-menu{
      position: absolute;
      top: 10px;
      right: 10px;
      z-index: 1;
    }
  }
</style>