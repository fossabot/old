<template>
  <div class="header">
    <div class="left">
      <div class="layout-switcher" :class="{hidden: participantCount <= 1}">
        <div class="switcher-item" @click="onChangeView('main')" :class="{'active': isGridView==false }">
          <IconMeetingMain />
        </div>
        <div class="switcher-item" @click="onChangeView('grid')" :class="{'active': isGridView}">
          <IconMeetingGrid />
        </div>
      </div>
      <div class="participant-label"><span>Participants: {{participantCount}}</span></div>
    </div>
    <div class="right">
      <ButtonFullScreen />
    </div>
  </div>
</template>

<script>
import ZoomController from '../../ZoomController'
import IconMeetingGrid from './../Icon/IconMeetingGrid.vue'
import IconMeetingMain from './../Icon/IconMeetingMain.vue'
import ButtonFullScreen from './ButtonFullScreen.vue'
export default {
  components: {IconMeetingGrid, IconMeetingMain, ButtonFullScreen},
  props: ['isParticipantsVideoShown', 'isInSession', 'liveOnNum'],
  data () {
    return {
      path: this.$route.path,
      sessionName: '',
      sessionPassword: '',
      participantCount: 0
    }
  },
  computed: {
    isGridView(){
      return this.$store.state.isGridView
    }
  },
  watch: {
    isInSession: {
      handler (val, objVal) {
        if (val) {
          // let sessionInfo = zoomVideoSdk.getSessionInfo()
          // this.sessionName = sessionInfo.getSessionName()
          // this.sessionPassword = sessionInfo.getSessionPassword()
        }
      }
    }
  },
  mounted() {
    this.participantCount = ZoomController.zoomClient.getAllUser().length;
    if(this.participantCount<=1){
      this.$store.commit('setGridView', true)
    }
    ZoomController.zoomClient.on('user-added', this.onUserUpdate)
    ZoomController.zoomClient.on('user-removed', this.onUserUpdate)
    ZoomController.zoomClient.on('user-updated', this.onUserUpdate)
  },
  unmounted(){
    ZoomController.zoomClient.off('user-added', this.onUserUpdate)
    ZoomController.zoomClient.off('user-removed', this.onUserUpdate)
    ZoomController.zoomClient.off('user-updated', this.onUserUpdated)
  },
  methods: {
    onUserUpdate(){
      this.participantCount = ZoomController.zoomClient.getAllUser().length;
      if(this.participantCount<=1){
        this.$store.commit('setGridView', true)
      }
    },
    handleClose () {
      ZoomController.endConference(true)
    },
    handleWindow (val) {
      // ipc.send(val)
    },
    onChangeView(type){
      if(type=='grid'){
        this.$store.commit('setGridView', true)
      }else{
        this.$store.commit('setGridView', false)
      }
    }
  }
}
</script>

<style lang="scss" scoped>
  .header {
    width: 100%;
    height: 40px;
    font-size: 12px;
    color: #fff;
    background: rgba(26, 26, 26, 0.8);
    .participant-label{
      left: 0;
      -webkit-app-region: no-drag;
      width: auto;
      height: auto;
      margin: 4px 5px 0;
      border-radius: 6px;
      display: inline-block;
      padding: 4px;
    }
    .layout-switcher{
      -webkit-app-region: no-drag;
      width: 80px;
      height: 40px;
      background: rgba(26, 26, 26, 0.8);
      display: inline-block;
      cursor: pointer;
      &.hidden{
        display: none;
      }
      .switcher-item{
        width: 35px;
        height: 35px;
        margin: 2px;
        display: inline-flex;
        justify-content: center;
        align-items: center;
        background: rgba(26, 26, 26, 0.8);
        &.active{
          background: rgba(255, 255, 255, 0.1);
          border: 2px solid rgba(255, 255, 255, 0.09);
          border-radius: 6px;
        }
        &:hover{
          background: rgba(255, 255, 255, 0.1);
          border: none;
          border-radius: 6px;
        }
      }
    }
  }
</style>